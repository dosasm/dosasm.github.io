<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DosAsm Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DosAsm Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">8 中断系统 | DosAsm</title><meta data-react-helmet="true" property="og:url" content="https://dosasm.github.io/docs/notes-njupt/中断系统"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="8 中断系统 | DosAsm"><meta data-react-helmet="true" name="description" content="分三次课讲述、各次的重点为"><meta data-react-helmet="true" property="og:description" content="分三次课讲述、各次的重点为"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dosasm.github.io/docs/notes-njupt/中断系统"><link data-react-helmet="true" rel="alternate" href="https://dosasm.github.io/docs/notes-njupt/中断系统" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dosasm.github.io/docs/notes-njupt/中断系统" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d9bfc96a.css">
<link rel="preload" href="/assets/js/runtime~main.5f318c0f.js" as="script">
<link rel="preload" href="/assets/js/main.76761419.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/my-img/dosboxasm.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/my-img/dosboxasm.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">DosAsm</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">教程</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/reference">参考</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://dosasm.gitee.io/dosrun" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>PlayGround<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/dosasm/dosasm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">DosAsm</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">工具</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">工具-更多</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/reference">参考</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">参考信息</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">参考-微机原理与接口技术</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/总览">目录</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/微型计算机基础">1 微型计算机基础</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/02_80x86微处理器">2 80x86微处理器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/汇编语言指令集">3 汇编语言指令集</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/汇编语言程序设计">4 汇编语言程序</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/输入输出系统">7 输入/输出系统</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/notes-njupt/中断系统">8 中断系统</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/串口通信">9 串口通信</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/并行IO接口">10 并行I/O 接口</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/可编程定时计数器">11 可编程定时器/计数器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes-njupt/题目">题目</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">8 中断系统</h1></header><p>分三次课讲述、各次的重点为</p><ul><li>中断的分类（知道了解）以及<strong>中断向量</strong>（计算，知道中断向量的引导过程，操作系统响应中断的过程）</li><li>微机系统中的可屏蔽中断，中断管理器8259（工作过程，自己语言描述，8259级联，pc机中时两片管理15级，从接在主的IR2上）</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="81中断的基本概念"></a>8.1中断的基本概念<a class="hash-link" href="#81中断的基本概念" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断概念的引入及描述"></a>中断概念的引入及描述<a class="hash-link" href="#中断概念的引入及描述" title="Direct link to heading">#</a></h3><p>查询方式当外设数据未准备好时,CPU需要不断查询外设数据是否准备好的状态,效率低</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断方式示意以输入中断为例"></a>中断方式示意(以输入中断为例)<a class="hash-link" href="#中断方式示意以输入中断为例" title="Direct link to heading">#</a></h4><div class="mermaid">sequenceDiagram
title:CPU采用中断方式与外设交换信息（以输入为例）
participant 现行程序
participant 输入接口
participant 输入设备

现行程序-&gt;&gt;输入设备:1.启动
note over  现行程序:2.cpu执行现行程序
输入设备-&gt;&gt;输入接口:3.数据
输入接口-&gt;&gt;现行程序:4.中断请求
现行程序-&gt;&gt;输入接口:5.中断响应
note over 现行程序:6.中断现行程序并执行中断服务子程序
输入接口-&gt;&gt;现行程序:7.数据
note over 现行程序:9.结束子程序返回现行程序</div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断的定义"></a><strong>中断</strong>的定义<a class="hash-link" href="#中断的定义" title="Direct link to heading">#</a></h4><p>中断：CPU在执行程序的过程中，由于某种外部或内部事件的作用，使CPU停止当前正在执行的程序而转去为该事件服务，待事件服务结束后，又能自动返回到被中止了的程序中继续执行的过程。</p><ul><li>被中断的源程序称为<strong>主程序</strong>；</li><li>中断处理程序称为<strong>中断服务子程序</strong></li><li>主程序被中止的地方，称为<strong>断点</strong>，也就是<strong>下一条</strong>指令所在内存的地址</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断源及中断分类"></a>中断源及中断分类<a class="hash-link" href="#中断源及中断分类" title="Direct link to heading">#</a></h3><p><strong>中断源</strong>：是能够引发CPU中断的信息源，分为两大类。</p><ul><li>（CPU）外部中断源（硬件中断源）<em>通过I/O接口发中断</em><ul><li>I/O设备 如键盘、显示器、打印机</li><li>数据通道 如磁带、磁盘</li><li>时钟 如8254 0#，由此引发的中断</li><li>故障源 如掉电、存储器奇偶校验错误</li></ul></li><li>（CPU）内部中断源（软件中断源、异常）<ul><li>执行INT<em>软件中断</em>指令 如执行指令<code>INT 21H</code></li><li>CPU指令执行产生的<em>异常</em> 如被0除、单步执行</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断的分类"></a>中断的分类<a class="hash-link" href="#中断的分类" title="Direct link to heading">#</a></h4><p>中断根据中断源可以分为：</p><ul><li>由外部事件所引发的中断，即由CPU以外的设备发出，并由CPU的中断请求信号引脚输入所引发的中断称为<strong>外部中断</strong>，也称为硬件中断（80x86中 <strong>INTR 可屏蔽硬件中断，NMI非屏蔽硬件中断</strong>）</li><li>由CPU内部事件，即由<em>CPU硬件故障</em>或<em>程序执行中的指令所引发的中断</em>称为<strong>内部中断</strong>。内部中断可以进一步分为<strong>软件中断和异常</strong>。<ul><li>执行有定义的INT N指令而引发的中断称为<em>软件中断</em>。软件中断可分为BIOS中断、DOS中断。DOS中断又分为DOS专用中断、DOS保留中断、用户可调用的DOS中断以及保留给用户开发的中断。</li><li>由于CPU本身故障、程序故障等引发的中断，称为<em>异常</em>。</li></ul></li></ul><div class="mermaid">graph LR
A((中断))--&gt;B[外部中断]
B--&gt;out1[INTR 可屏蔽硬件中断]
B--&gt;out2[NMI 非屏蔽硬件中断]---au
A--&gt;B2[内部中断]
B2--&gt;C[异常]---au
B2--&gt;C2[软件中断]
D[BIOS中断]
D2[DOS中断]
C2--&gt;D
C2--&gt;D2
D2--&gt;E2[DOS专用中断]
D2--&gt;E[DOS保留中断]
au(内部自动产生中断类型码)</div><p>外部中断和异常的发生是随机的。</p><p>常见的<strong>异常</strong>：</p><ul><li>除法错中断——当除法结果溢出或者除数为0时，发生的中断。</li><li>单步或陷阱中断——执行每条指令后，如果标志寄存器的T标志（陷阱标志）为1时,则产生中断。</li><li>断点中断——CPU执行“INT 3”指令后,进入相应的中断服务程序。INT 3指令通常用于调试程序时设置程序断点。</li><li>溢出中断——CPU执行“INT 4”指令,或者标志寄存器O标志（溢出标志）为1时，执行“INTO”指令，进入相应的中断服务程序。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断类型码"></a>中断类型码<a class="hash-link" href="#中断类型码" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断类型码-1"></a>中断类型码<a class="hash-link" href="#中断类型码-1" title="Direct link to heading">#</a></h4><p>为了区别各种不同的中断，微机系统给每一个中断分配了一个中断号n，即中断类型码，其取值范围是0~255。微机系统可以处理<strong>256种中断</strong>，在这256个中断中，intel 在它各种微处理器中都保留了前32个（0—31）为系统所专用，后224个可由用户设定。</p><table><thead><tr><th>常用中断号</th><th>对应中断</th></tr></thead><tbody><tr><td>0型中断</td><td>除法错中断</td></tr><tr><td>1型中断</td><td>单步或陷阱中断</td></tr><tr><td>2型中断</td><td>非屏蔽硬件中断</td></tr><tr><td>3型中断</td><td>断点中断</td></tr><tr><td>4型中断</td><td>溢出中断</td></tr><tr><td>5型中断</td><td>屏幕打印</td></tr><tr><td>08H～0FH型中断</td><td>可屏蔽硬件中断</td></tr><tr><td>10H～1FH型中断</td><td>BIOS中断（10H，16H）</td></tr><tr><td>20H～3FH型中断</td><td>DOS中断（21H）</td></tr></tbody></table><p><a href="#%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E4%B8%8E%E4%B8%AD%E6%96%AD%E5%88%86%E7%BA%A7">中断优先级</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断向量"></a>中断向量<a class="hash-link" href="#中断向量" title="Direct link to heading">#</a></h4><p>⭐<strong>中断向量是实模式下，中断服务子程序的入口地址。</strong>它由两部分组成：</p><ul><li>服务程序入口的偏移地址  2个字节(4n~4n+1)</li><li>服务程序所在代码段的段基址          2个字节(4n+2~4n+3)</li></ul><p>例：若四个单元内容为11H，22H，33H，44H，则入口地址为：(中断向量表的表地址与中断类型的关系）</p><p><strong>答</strong>： 偏移地址：2211H 段基址：4433，所以入口地址为<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2211</mn><mi>H</mi><mo>+</mo><mn>44330</mn><mi>H</mi><mo>=</mo><mn>46541</mn><mi>H</mi></mrow><annotation encoding="application/x-tex">2211H+44330H=46541H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">1</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord">4</span><span class="mord">4</span><span class="mord">3</span><span class="mord">3</span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord">4</span><span class="mord">6</span><span class="mord">5</span><span class="mord">4</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.08125em">H</span></span></span></span></span></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断向量表"></a>中断向量表<a class="hash-link" href="#中断向量表" title="Direct link to heading">#</a></h4><p>中断类型码通过一个<strong>地址指针表</strong>与<strong>中断服务程序的入口地址</strong>相联系。</p><ul><li>实模式下：该表称为<strong>中断向量表</strong></li><li>保护模式下：该表称为中断描述符表。</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断向量表的设置"></a>中断向量表的设置<a class="hash-link" href="#中断向量表的设置" title="Direct link to heading">#</a></h5><p>CPU规定：在实模式下，中断向量表需设置在系统的RAM最低端的1k单元（000000H~003FFH）<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>256</mn><mo stretchy="false">(</mo><msup><mn>2</mn><mn>8</mn></msup><mo stretchy="false">)</mo><mo>×</mo><mn>4</mn><mo>=</mo><msup><mn>2</mn><mn>10</mn></msup><mo>=</mo><mn>1</mn><mi>k</mi></mrow><annotation encoding="application/x-tex">256(2^8)\times4=2^{10}=1k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span></span></span></span></span></p><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">n</span></span></span></span></span>型中断向量存放在<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi>n</mi><mo>∼</mo><mn>4</mn><mi>n</mi><mo>+</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">4n\sim4n+3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">4</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em"></span><span class="mord">4</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">3</span></span></span></span></span></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断向量表的初始化"></a><strong>中断向量表的初始化</strong><a class="hash-link" href="#中断向量表的初始化" title="Direct link to heading">#</a></h5><p>谁（DOS,BIOS,用户）设计（开发)的程序，由谁将它写入中断向量</p><p>DOS设计的两个专门用于中断向量的读出与写入的代码</p><table><thead><tr><th>INT21H</th><th>35H子功能</th><th>25H子功能</th></tr></thead><tbody><tr><td>功能</td><td><strong>读出</strong>n型中断向量</td><td><strong>写入</strong>n型中断向量</td></tr><tr><td>入口</td><td>AL=中断类型码</td><td>DS=中断服务程序所在代码段的段基址<br>DX=中断服务程序入口的偏移地址<br>AL=中断类型码</td></tr><tr><td>出口</td><td>ES:BX=n型中断向量</td><td>无</td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="将中断向量写入中断向量表"></a>将中断向量写入中断向量表<a class="hash-link" href="#将中断向量写入中断向量表" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly assembly"><pre tabindex="0" class="prism-code language-assembly codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">;方法一、用户自己编写程序填写中断向量</span></span><span class="token-line" style="color:#393A34"><span class="token plain">CLI;关中断</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PUSH DS;程序会破坏DS内容，所以先将DS保存</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV AX,0000H</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV DS,AX;给DS赋值</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV BX,4*n</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV AX,OFFSET SERVICE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV [BX],AX;写入程序起始地址的偏移地址，这里需要使用DS间址寻址，省略了段基址</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV AX,SEG SERVICE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV [BX+2],AX;写入段基址</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POP DS</span></span><span class="token-line" style="color:#393A34"><span class="token plain">STI;开中断</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly assembly"><pre tabindex="0" class="prism-code language-assembly codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">;采用方法2，使用DOS自带的子程序，对应的程序段如下：</span></span><span class="token-line" style="color:#393A34"><span class="token plain">CLI</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PUSH DS</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PUSHA</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV AX,SEG SERVICE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV DS,AX;写入段基址</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV DX,OFFSET SERVICE;写入偏移地址</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV AH,25H</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV AL,n</span></span><span class="token-line" style="color:#393A34"><span class="token plain">INT 21H</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POPA</span></span><span class="token-line" style="color:#393A34"><span class="token plain">POP DS</span></span><span class="token-line" style="color:#393A34"><span class="token plain">STI</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断响应和处理过程"></a>中断响应和处理过程<a class="hash-link" href="#中断响应和处理过程" title="Direct link to heading">#</a></h5><p>微机系统各种类型中断的响应和处理过程不完全相同，主要区别在于中断类型码的获得方式不同,当CPU获得了中断类型码后的处理过程基本类似。
|中断类型|中断类型码|
|---|---|
|非屏蔽硬件中断请求|CPU内部会<strong>自动</strong>产生中断类型码<strong>2</strong>|
|可屏蔽硬件中断请求|当CPU处于开中断状态时，由<strong>外部中断控制器</strong>将相应的中断类型码送给CPU|
|异常|中断类型码也是<strong>自动</strong>形成的|
|INT n指令|中断类型码即为<strong>指令</strong>中给定的n|</p><p>CPU获得了中断类型码n后，中断的处理过程如下：</p><ol><li>F寄存器→栈(保存中断处理之前的F状态)使F中的<ul><li>T标志置0——禁止单步操作</li><li>I标志置0——CPU处于关中断状态</li></ul></li><li>断点地址→栈<ol><li>先：断点基地址(CS) →栈，</li><li>后：断点偏移地址(IP)→栈</li></ol></li><li>CPU从4n ～4n+3单元取出n型服务程序入口地址→IP:CS,从而转入n型中断服务程序。</li><li>服务程序执行完毕，执行中断返回指令。中断返回指令的功能是按顺序恢复断点处的IP值、CS值和之前保护的相应中断前的标志寄存器内容→标志寄存器。CPU根据恢复后的CS:IP返回断点，继续执行主程序。</li></ol><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断向量的引导作用"></a>中断向量的引导作用<a class="hash-link" href="#中断向量的引导作用" title="Direct link to heading">#</a></h5><p><img alt="image-20200417163557084" src="/assets/images/image-20200417163557084-3377c334fc42d7a2050da2af1e4c0d50.png"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断服务子程序的结构"></a>中断服务子程序的结构<a class="hash-link" href="#中断服务子程序的结构" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly assembly"><pre tabindex="0" class="prism-code language-assembly codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ISR PROC</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ;保护现场</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ;中断处理</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ;恢复现场</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ;中断返回是IRET弹出六个字节，RET不能实现要求</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ISR ENDP</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="82多级中断管理"></a>8.2多级中断管理<a class="hash-link" href="#82多级中断管理" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1中断优先与中断分级"></a>1.中断优先与中断分级<a class="hash-link" href="#1中断优先与中断分级" title="Direct link to heading">#</a></h3><p>当有多个中断源在同一时刻提出请求时，CPU对中断响应的次序称中断优先级。（中断响应的次序是用排队器硬件实现的，可以由程序控制改变实际的中断处理次序）<a href="#%E4%B8%AD%E6%96%AD%E7%B1%BB%E5%9E%8B%E7%A0%81">前文提到的中断类型码</a></p><p>80X86响应中断的优先级如下：</p><table><thead><tr><th></th><th>中断类型优先级</th></tr></thead><tbody><tr><td>1</td><td>除法错中断<strong>最高</strong></td></tr><tr><td>2</td><td>软件中断INT n ↓</td></tr><tr><td>3</td><td>断点中断↓</td></tr><tr><td>4</td><td>溢出中断INTO↓</td></tr><tr><td>5</td><td>NMI中断↓（非屏蔽）</td></tr><tr><td>6</td><td>INTR中断↓（可屏蔽）</td></tr><tr><td>7</td><td>单步中断<strong>最低</strong></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2禁止中断与中断屏蔽"></a>2.禁止中断与中断屏蔽<a class="hash-link" href="#2禁止中断与中断屏蔽" title="Direct link to heading">#</a></h3><ul><li>禁止中断：产生中断请求后，CPU不能中断现行程序的执行。</li><li>中断屏蔽：用程序有选择地封锁部分中断，而允许其余部分仍可得到响应。</li><li>软件中断与硬件中断甚至可以“相互中断”</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3中断嵌套"></a>3.中断嵌套<a class="hash-link" href="#3中断嵌套" title="Direct link to heading">#</a></h3><p>中断嵌套：在执行中断服务程序时，仍可再响应中断申请。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4中断系统应具备的基本功能"></a>4.中断系统应具备的基本功能<a class="hash-link" href="#4中断系统应具备的基本功能" title="Direct link to heading">#</a></h3><ul><li>对于硬件中断,接口电路应具备‘屏蔽’和‘开放’的功能,这种功能由程序员通过软件去控制。</li><li>能实现<strong>中断判优</strong>（中断排队），当有多个中断源提出请求时,应能优先响应高级别的中断源。</li><li>能够实现<strong>中断嵌套</strong>。</li><li>响应中断后，能自动<strong>转入</strong>中断处理，处理完毕能自动<strong>返回</strong>断点。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="83-80x86的中断指令"></a>8.3 80x86的中断指令<a class="hash-link" href="#83-80x86的中断指令" title="Direct link to heading">#</a></h2><ol><li>开中断指令<code>STI</code>：指的是CPU可否响应中断请求，<code>STI</code>和<code>CLI</code>只对可屏蔽<strong>硬件</strong>中断INTR有用<ul><li>功能：使F寄存器中I标志置1,CPU处于开中断状态。</li></ul></li><li>关中断指令<code>CLI</code>：<ul><li>功能：使F寄存器中I标志置0,CPU处于关中断状态。</li></ul></li><li>软件中断指令<code>INT  n</code><ul><li>n为中断类型码,n为0～255之间<strong>有定义</strong>的无符号整数。功能：无条件转向n型中断服务子程序。</li></ul></li><li>中断返回指令<code>IRET</code>: IRET 是中断服务子程序的出口指令<ul><li>功能：依次从栈顶弹出<strong>6个元素</strong>→IP,CS,F。如果栈顶是INT   n  的断口地址，则执行IRET后，返回断点，否则不能。SP会变大（加六）</li></ul></li><li>溢出中断指令<code>INTO</code><ul><li>功能：先判别F寄存器中O标志位是否为1，如是则直接调用类型为4的中断子程序，用以处理溢出中断。</li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="int-n指令的执行过程"></a>INT n指令的执行过程<a class="hash-link" href="#int-n指令的执行过程" title="Direct link to heading">#</a></h3><p><a href="#%E4%B8%AD%E6%96%AD%E5%93%8D%E5%BA%94%E5%92%8C%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B">与中断响应和处理过程的1.2.3步一致</a></p><p>❌软件中断指令 INT n,n是0~255之间的任意无符号整数。❎</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="84-中断控制器8259a"></a>8.4 中断控制器8259A<a class="hash-link" href="#84-中断控制器8259a" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="841-8259a功能"></a>8.4.1 8259A功能<a class="hash-link" href="#841-8259a功能" title="Direct link to heading">#</a></h3><ol><li>一片8259A中断控制器可以管理8级中断</li><li>每一级中断都可以通过设置内部屏蔽字进行屏蔽或允许。</li><li>在中断响应周期，8259A可以向CPU提供相应的中断类型码。</li><li>8259A是很复杂的中断控制器，可以通过编程从中断触发方式、中断屏蔽方式、中断优先级管理方式、中断结束方式和总线连接5个方面对中断进行管理。</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="8259a主从级联"></a>8259A主从级联<a class="hash-link" href="#8259a主从级联" title="Direct link to heading">#</a></h4><p>2片8259A通过级联，采用1主1从的方式，可管理15级中断。</p><p>通过级联，采用1主8从的方式，可扩展管理<strong>64级中断</strong>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="842-8259a结构"></a>8.4.2 8259A结构<a class="hash-link" href="#842-8259a结构" title="Direct link to heading">#</a></h3><p><img alt="image-20200415195239990" src="/assets/images/image-20200415195239990-2d9adc2e1edf7483cadb43dc62434f53.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="8259a内部结构"></a>8259A内部结构<a class="hash-link" href="#8259a内部结构" title="Direct link to heading">#</a></h4><ol><li><strong>中断请求寄存器( IRR)</strong><br>寄存引脚IR0～IR7的中断请求信号,IRRi位置1，表明IRi引脚上有了中断请求信号</li><li><strong>中断屏蔽寄存器(IMR)</strong><br>寄存程序员写入的中断屏蔽字，屏蔽字某位=1(IMRi位=1),则与该位对应的中断请求信号(IRRi位)就不能送到中断优先权电路</li><li><strong>优先权电路（排队电路）</strong><ol><li>比较同时送达优先权电路的中断请求，哪一个级别最高。</li><li>比较CPU正为之服务的中断源和刚进入优先权电路的中断源，哪一个级别更高。</li><li>通过判优‘选中’其中级别最高的中断源，然后通过控制电路，从INT端向CPU提中断请求。中断控制器8259A内部结构</li><li><strong>中断控制电路</strong></li><li><strong>中断服务寄存器</strong>(ISR)<ol><li>通过判优电路IRR0位的请求被选中，8259A向CPU发中断请求，通过<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>I</mi><mi>N</mi><mi>T</mi><mi>A</mi></mrow><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\overline{INTA}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8833300000000001em;vertical-align:0em"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833300000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mord mathnormal">A</span></span></span><span style="top:-3.80333em"><span class="pstrut" style="height:3em"></span><span class="overline-line" style="border-bottom-width:0.04em"></span></span></span></span></span></span></span></span></span></span>收到第一个中断响应信号后，ISR0位置1，IRR0位置0。ISR0位置1，表明CPU正在准备(或正在)执行IR0的服务程序。</li><li>反之，如果ISR0位由1 →0，表明IR0的中断服务程序执行完了所以ISR的每一位都是响应中断源的中断服务标志位。中断控制器8259A内部结构</li></ol></li></ol></li><li><strong>数据总线缓冲器</strong><ul><li>完成与CPU数据线配接</li><li>接收初始化命令字，操作命令字</li><li>当收到第二个中断响应脉冲时，通过他们向CPU送出被选中的中断源的中断类型码n</li></ul></li><li><strong>读/写控制模块</strong></li><li><strong>级联/缓冲比较器</strong></li></ol><p>控制逻辑电路</p><p><img alt="控制逻辑电路" src="/assets/images/image-20200422083514273-f148b9d56ace9a097180305d2d0da39c.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="8259a外部中断"></a>8259A外部中断<a class="hash-link" href="#8259a外部中断" title="Direct link to heading">#</a></h4><p><img alt="image-20200417185203643" src="/assets/images/image-20200417185203643-a205f135ae147addc8f3b2f0b2192f02.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断控制器8259a中断过程cpu响应可拼比硬件中断的过程"></a>中断控制器8259A中断过程——CPU响应可拼比硬件中断的过程<a class="hash-link" href="#中断控制器8259a中断过程cpu响应可拼比硬件中断的过程" title="Direct link to heading">#</a></h4><ol><li>首先由中断请求寄存器寄存加到引脚<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mn>0</mn></msub><mo>∼</mo><mi>I</mi><msub><mi>R</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">IR_0\sim IR_7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>的中断请求</li><li>在中断屏蔽寄存器的管理下，没有被屏蔽的中断请求被送到优先权电路判优</li><li>经过优先权电路的判别，选中当前级别最高的中断源，然后从引脚INT向CPU发出中断请求信号</li><li>CPU满足一定条件后，向8259A发出2个中断响应信号（负脉冲）</li><li>8259A从引脚<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>I</mi><mi>N</mi><mi>T</mi><mi>A</mi></mrow><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\overline{INTA}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8833300000000001em;vertical-align:0em"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833300000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mord mathnormal">A</span></span></span><span style="top:-3.80333em"><span class="pstrut" style="height:3em"></span><span class="overline-line" style="border-bottom-width:0.04em"></span></span></span></span></span></span></span></span></span></span>收到第1个中断信号之后，立即使中断服务寄存器中与被选中的中断源对应的那位置1，同时把中断请求寄存器中的相应位清0</li><li>从引脚<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>I</mi><mi>N</mi><mi>T</mi><mi>A</mi></mrow><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\overline{INTA}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8833300000000001em;vertical-align:0em"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833300000000001em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mord mathnormal">A</span></span></span><span style="top:-3.80333em"><span class="pstrut" style="height:3em"></span><span class="overline-line" style="border-bottom-width:0.04em"></span></span></span></span></span></span></span></span></span></span>收到第2个中断响应信号后，8259A把选中的中断源类型码n，通过数据线送往CPU</li><li>在实模式下，CPU从<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>×</mo><mi>n</mi><mo>∼</mo><mn>4</mn><mo>×</mo><mi>n</mi><mo>+</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">4\times n\sim 4\times n +3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">3</span></span></span></span></span>单元取出该中断源的中断向量<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⟶</mo><mi>I</mi><mi>P</mi><mo separator="true">,</mo><mi>C</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">\longrightarrow IP,CS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.522em;vertical-align:-0.011em"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span></span></span></span></span>，从而引导CPU执行该中断源的中断服务程序</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="843-8259a的中断管理方式"></a>8.4.3 8259A的中断管理方式<a class="hash-link" href="#843-8259a的中断管理方式" title="Direct link to heading">#</a></h3><div class="mermaid">graph LR
A[8259A中断管理方式]
A--&gt;B1{中断触发方式}
B1--&gt;C11(边缘触发)
B1--&gt;C12(电平触发)
A--&gt;B2{中断屏蔽方式}
B2--&gt;C21(常规屏蔽方式)
B2--&gt;C22(特殊屏蔽方式)
A--&gt;B3{中断优先级管理方式}
B3--&gt;C31[完全嵌套方式]
B3--&gt;C32[特殊嵌套方式]
B3--&gt;C33[优先级循环方式]
C33---D1(常规EOI循环方式)
C33--&gt;D2(自动EOI循环方式)
C33--&gt;D3(特殊EOI循环方式)
A--&gt;B4{中断结束方式}--&gt;C41[自动EOI方式]
B4--&gt;C42[非自动EOI方式]
C42--&gt;E1(常规EOI方式)
C42--&gt;E2(特殊EOI方式)
A--&gt;B5{总线连接方式}
B5--&gt;f1(缓冲方式)
B5--&gt;f2(非缓冲方式)</div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断触发方式"></a>中断触发方式<a class="hash-link" href="#中断触发方式" title="Direct link to heading">#</a></h4><ul><li><strong>边沿触发</strong>（<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">IR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>出现上升沿表示有中断请求）</li><li><strong>电平触发</strong>（<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">IR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>出现高电平表示有中断请求）</li></ul><p>80X86微机中采用<strong>边沿</strong>触发方式</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="屏蔽中断源方式"></a>屏蔽中断源方式<a class="hash-link" href="#屏蔽中断源方式" title="Direct link to heading">#</a></h4><ul><li><strong>常规屏蔽方式</strong><br>MR屏蔽字决定了允许或禁止某位<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">IR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>所对应的中断：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">IM_i=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>禁止，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">IM_i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span>允许</li><li><strong>特殊屏蔽方式</strong><ul><li>提供了允许较低优先级的中断能够得到响应的特殊手段</li><li>当一个中断被响应时，仅屏蔽同级别的再次中断，而允许较低和较高级别的中断源中断正在执行的当前中断服务程序
80x86采用<strong>常规屏蔽</strong>方式</li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断优先级管理方式"></a>中断优先级管理方式<a class="hash-link" href="#中断优先级管理方式" title="Direct link to heading">#</a></h4><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="优先级控制方式"></a>优先级控制方式<a class="hash-link" href="#优先级控制方式" title="Direct link to heading">#</a></h4><ol><li>固定优先级方式<ul><li>所有中断请求<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">IR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>的中断优先级固定不变</li><li>加电后8259A的默认方式，默认优先级顺序从高到低为<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mn>0</mn></msub><mo>∼</mo><mi>I</mi><msub><mi>R</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">IR_0\sim IR_7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span></li></ul></li><li>循环优先级方式<ul><li>中断源轮流处于最高优先级，即自动中断优先级循环</li><li>某中断请求<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">IR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>被处理后，其优先级别自动降为最低，原来比它低一级的中断上升为最高级</li></ul></li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断嵌套方式"></a>中断嵌套方式<a class="hash-link" href="#中断嵌套方式" title="Direct link to heading">#</a></h4><p>在中断处理过程中允许被更高优先级的时间所中断称为中断嵌套。8259A有两种中断嵌套方式：</p><ul><li>普通全嵌套方式(默认方式)<br>一中断正被处理时，只有更高优先级的时间可以打断当前的中断处理过程而被服务</li><li>特殊全嵌套方式<br>一中断正被处理时，允许统计或更高优先级的事件可以打断当前的中断处理过程</li></ul><p>80x86采用<strong>固定优先级、普通全嵌套</strong>方式</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="中断结束处理方式"></a>中断结束处理方式<a class="hash-link" href="#中断结束处理方式" title="Direct link to heading">#</a></h4><p>当某一<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">IR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>中断被服务时，ISR中的相应位<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>S</mi><msub><mi>R</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">ISR_i=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>.当服务结束后，则必须清零该<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>S</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">ISR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>。当服务结束后，则必须清零该<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>S</mi><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">ISR_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>位。使<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>S</mi><msub><mi>R</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">ISR_i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span>是通过向8259A发出中断结束命令（EOI命令）实现的。</p><p>三种EOI命令</p><ul><li>自动EOI（AEOI）<sup id="fnref-aeoi"><a href="#fn-aeoi" class="footnote-ref">AEOI</a></sup>——（自动EOI方式）</li><li>指定EOI（SEOI）<sup id="fnref-seoi"><a href="#fn-seoi" class="footnote-ref">SEOI</a></sup>——（特殊EOI方式）</li><li>非指定EOI（NSEOI）<sup id="fnref-nseoi"><a href="#fn-nseoi" class="footnote-ref">NSEOI</a></sup>——（正常/常规EOI方式)</li></ul><p>80x86微机中采用NSEOI（常规中断结束）方式</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="8259a的编程"></a>8259A的编程<a class="hash-link" href="#8259a的编程" title="Direct link to heading">#</a></h4><p>20H是最常用的中断结束命令字</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="852-非屏蔽中断"></a>8.5.2 非屏蔽中断<a class="hash-link" href="#852-非屏蔽中断" title="Direct link to heading">#</a></h3><p>⭐<strong>非屏蔽中断</strong>：输入到CPU的NMI引脚的请求信号引发的中断</p><p>⭐响应非屏蔽中断的<strong>条件</strong></p><ol><li>有非屏蔽中断请求，没有DMA请求</li><li>一条指令执行完</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cpu响应非屏蔽中断的过程"></a>CPU响应非屏蔽中断的过程<a class="hash-link" href="#cpu响应非屏蔽中断的过程" title="Direct link to heading">#</a></h4><p>CPU在每一条指令的最后一个时钟周期,检测NMI引脚。处理器不屏蔽来自NMI的中断请求。
处理器在响应NMI中断时，不从外部硬件接收中断向量号。在80X86中，非屏蔽中断所对应的中断向量号固定为2。为了非屏蔽中断的嵌套，每当接受一个NMI中断，处理器就在内部屏蔽了再次响应NMI，这一屏蔽过程直到执行中断返回指令IRET后才结束。所以，NMI处理程序应以IRET指令结束。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="853-可屏蔽中断"></a>8.5.3 可屏蔽中断<a class="hash-link" href="#853-可屏蔽中断" title="Direct link to heading">#</a></h3><p><strong>可屏蔽中断</strong>：输入到INTR引脚的中断请求信号，引发的中断</p><p><strong>硬件中断的级别</strong>：DMA请求&gt;非屏蔽中断&gt;可屏蔽中断</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1响应可屏蔽中断的条件"></a>1.响应可屏蔽中断的条件<a class="hash-link" href="#1响应可屏蔽中断的条件" title="Direct link to heading">#</a></h4><ol><li>有可屏蔽中断请求，没有DMA请求，没有非屏蔽中断请求</li><li>CPU一条指令执行完毕</li><li>CPU处于开中断状态（I标为1）</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2cpu响应可屏蔽中断过程"></a>2.CPU响应可屏蔽中断过程<a class="hash-link" href="#2cpu响应可屏蔽中断过程" title="Direct link to heading">#</a></h4><p>​    CPU在每一条指令的最后一个时钟周期，检测INTR引脚，当检测到有可屏蔽中断请求时，在满足上述条件的前提下，通过总线控制器向系统8259A发出中断响应信号(2个负脉冲)。在获得8259A送来的中断类型码之后，在实模式下查询中断向量表,从而转向相应中断源的中断服务程序。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3pc系列机可屏蔽中断的硬件结构"></a>3.PC系列机可屏蔽中断的硬件结构<a class="hash-link" href="#3pc系列机可屏蔽中断的硬件结构" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1使用2篇8259级连，管理15级中断"></a>1.使用2篇8259级连，管理15级中断<a class="hash-link" href="#1使用2篇8259级连，管理15级中断" title="Direct link to heading">#</a></h5><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2中断源与中断类型"></a>2.中断源与中断类型<a class="hash-link" href="#2中断源与中断类型" title="Direct link to heading">#</a></h5><table><thead><tr><th><strong>主8259</strong></th><th><strong>中断源</strong></th><th><strong>中断类型</strong></th><th><strong>从8259</strong></th><th><strong>中断源</strong></th><th><strong>中断类型</strong></th></tr></thead><tbody><tr><td><strong>IR0</strong></td><td><strong>日时钟</strong></td><td><strong>08H</strong></td><td><strong>IR0</strong></td><td><strong>实时时钟</strong></td><td><strong>70H</strong></td></tr><tr><td><strong>IR1</strong></td><td><strong>键盘</strong></td><td><strong>09H</strong></td><td><strong>IR1</strong></td><td><strong>用户中断</strong></td><td><strong>71H改向0AH</strong></td></tr><tr><td><strong>IR2</strong></td><td><strong>从8259</strong></td><td>---</td><td>IR2</td><td>保留</td><td>72H</td></tr><tr><td>IR3</td><td>辅串口</td><td>0BH</td><td>IR3</td><td>保留</td><td>73H</td></tr><tr><td>IR4</td><td>主串口</td><td>0CH</td><td>IR4</td><td>保留</td><td>74H</td></tr><tr><td>IR5</td><td>并行口2</td><td>0DH</td><td>IR5</td><td>协处理器</td><td>75H</td></tr><tr><td>IR6</td><td>软盘</td><td>0EH</td><td>IR6</td><td>硬盘</td><td>76H</td></tr><tr><td>IR7</td><td>并行口1</td><td>0FH</td><td>IR7</td><td>保留</td><td>77H</td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3系统分配的8259口地址"></a>3.系统分配的8259口地址<a class="hash-link" href="#3系统分配的8259口地址" title="Direct link to heading">#</a></h5><table><thead><tr><th></th><th><strong>中断屏蔽寄存器口地址</strong></th><th><strong>接收中断结束命令的寄存器口地址</strong></th></tr></thead><tbody><tr><td><strong>主8259</strong></td><td><strong>21H</strong></td><td><strong>20H</strong></td></tr><tr><td><strong>从8259</strong></td><td><strong>0A1H</strong></td><td><strong>A0H</strong></td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4硬件可屏蔽中断的中端级别"></a>4.硬件可屏蔽中断的中端级别<a class="hash-link" href="#4硬件可屏蔽中断的中端级别" title="Direct link to heading">#</a></h5><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5中断结束命令"></a>5.中断结束命令<a class="hash-link" href="#5中断结束命令" title="Direct link to heading">#</a></h5><ol><li>命令字为<code>20H</code></li><li>接入<code>主8259A</code> IR~0~ ,IR~1~,IR~3~~IR~7~的中断源，其服务程序结束要向主8259送中断结束命令字</li><li>接入从8259的中断源，经主<code>8259A</code>的IR2向INTR提中断请求，其服务程序结束应分别向主、从8259各送一个中断结束命令字 。</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly assembly"><pre tabindex="0" class="prism-code language-assembly codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">;接入主8259A  IR0，IR1，IR3 ～IR7的中断源其服务程序结束要向主8259送中断结束命令字</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV  AL，20H</span></span><span class="token-line" style="color:#393A34"><span class="token plain">OUT  20H，AL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">;恢复现场</span></span><span class="token-line" style="color:#393A34"><span class="token plain">IRET</span></span><span class="token-line" style="color:#393A34"><span class="token plain">;接入从8259的中断源，经主8259A的IR2向INTR提中断请求，其服务程序结束应分别向主、从8259各送一个中断结束命令字 。</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MOV    AL，20H</span></span><span class="token-line" style="color:#393A34"><span class="token plain">OUT    20H，AL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">OUT    0A0H，AL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">;恢复现场</span></span><span class="token-line" style="color:#393A34"><span class="token plain">IRET</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="86-微型计算机系统中用到的中断及应用举例"></a>8.6 微型计算机系统中用到的中断及应用举例<a class="hash-link" href="#86-微型计算机系统中用到的中断及应用举例" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="861-日时钟中断"></a>8.6.1 日时钟中断<a class="hash-link" href="#861-日时钟中断" title="Direct link to heading">#</a></h3><blockquote><p>BIOS系统规定：40H:6CH～40H:6FH这4个单元
(共32位)为日时钟计数器，每55ms加1次，计数
到:001800B0H，为24小时,其计数值供系统软件使用。
系统启动时CPU执行BIOS中的一段程序，读取CMOS实
时时钟电路的时间值→计数值→40:6CH～40:6FH做
为日时钟计数器的计数初值。</p></blockquote><p> <img alt="image-20200429153455656" src="/assets/images/image-20200429153455656-5a96ed2f9fa75a780d89576200852be1.png"></p><ol><li><strong>中断源</strong>：系统8254 0#计数器，每55ms发一次中断请求</li><li><strong>中断类型</strong>：08H</li><li><strong>日时钟中断处理流程</strong>：（CPU转入8型中断后，完成下列工作）
1.开中断，保护现场（DS压栈）
2.40H给DS，对“日时钟级数器”加1
3.测算软驱马达关闭时间
4.执行 <code>INT 1CH</code>
5.向主8259送中断结束命令
6.恢复现场DS,<code>IRET</code></li></ol><p><strong>关于1CH服务程序</strong>（软件中断）</p><ul><li>8# 服务程序，每隔55ms在DS=40H的前提下，调用一次1CH服务程序，之后又返回8型</li><li>所以1CH中断是日时钟的附加中断，用户可开发新的1CH中断服务程序(完成每55ms一次的定时操作)取代系统原来的中断服务子程序</li></ul><p><strong>软件中断和硬件中断可以相互嵌套</strong>他们之间的优先级是指当中断请求同时发生时高优先级的中断优先响应，不存在低优先级无法打断高优先级的说法</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="系统日时钟中断的开发应用"></a>系统日时钟中断的开发应用<a class="hash-link" href="#系统日时钟中断的开发应用" title="Direct link to heading">#</a></h4><ol><li>置换中断向量，（08H或1CH）<ul><li>当用户程序的某项定时操作，其定时周期等于55ms的整数倍时，可定义用户程序的定时操作为1CH中断。此时需要置换1CH型中断向量，调用DOS系统25H号子程序把用户定时中断服务程序入口地址写入4×1CH～4×1CH ＋3单元。</li><li>当用户程序的定时操作,其定时周期不等于55ms的整数倍或者小于55ms时，需要重新对8254 0#计数器进行编程，定义输出周期为用户定时周期与55ms的<strong>最大公约数</strong>，此时用户中断服务程序为08H型，此时需要置换08H型中断向量，调用DOS系统25H号子程序把用户定时中断服务程序入口地址写入4×08H～4×08H＋3单元。</li></ul></li><li>用户中断服务程序结束<ul><li>若用户定时中断定义为1CH型，服务程序结束前不需要向主8259A送结束命令。</li><li>若用户定时中断定义为08H型， 服务程序结束前，需要先向主8259A送中断结束命令</li></ul></li><li>中断服务程序的执行时间<ul><li>定时中断服务程序的执行时间，必须远远小于定时中断的时间间隔</li></ul></li><li>避免DOS重入（DOS不允许重入）</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="862-键盘中断"></a>8.6.2 键盘中断<a class="hash-link" href="#862-键盘中断" title="Direct link to heading">#</a></h3><p>可屏蔽硬件中断</p><ol><li>键盘<strong>中断源</strong>是主板键盘接口电路</li><li><strong>中断类型</strong>：09H</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="863-实时中断"></a>8.6.3 实时中断<a class="hash-link" href="#863-实时中断" title="Direct link to heading">#</a></h3><ol><li><strong>中断源</strong>是主板中的实时时钟电路</li><li><strong>中断类型</strong>：70H</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="864-用户中断"></a>8.6.4 用户中断<a class="hash-link" href="#864-用户中断" title="Direct link to heading">#</a></h3><ol><li>系统用户中断的<strong>中断源</strong>是系统的ISR总线<strong>B~4~</strong>端子（IRQ9）引入的中断请求信号，接到从8259的IR1经过INT接到主8259的IR2端，通过INT接到INTR</li><li><strong>中断类型</strong>：<code>71H</code>（转向0AH）</li><li><strong>系统用户中断处理流程</strong>BIOS设计的71H型中断服务程序处理流程如下：<ol><li>开中断、保护现场；</li><li>向从8259A发出中断结束命令
<code>MOV     AL, 20H;OUT     0A0H, AL</code></li><li>执行<code>INT  0AH</code>,转向<code>0AH</code>服务程序。
<code>0AH</code>服务程序是用户预先设计好的,其中断向量已经存放在系统RAM <code>4×0AH～4×0AH＋3</code>单元。</li></ol></li></ol><p>用户中断是微机系统为用户开发可屏蔽中断预备的中断口。在用户中断程序的设计中，需要采取以下措施：</p><ol><li>把外扩中断源的中断请求(由低电平到高电平的跃变)接入ISA总线B4端子</li><li>开放用户中断</li><li>置换中断向量</li></ol><p>CPU响应用户中断后，自动转向“71H型”服务程序。根据BIOS设计的71H型中断服务程序处理流程，可以知道，用户自行设计的用户中断服务程序类型可以是“71H”，也可以是0AＨ。</p><ol><li><p>定义用户中断服务程序为<code>0AH型</code>，置换0AH型中断向量,调用DOS系统25H号子程序把用户中断的服务程序入口地址写入4×0AH～4×0AH＋3单元。</p></li><li><p>定义用户中断服务程序为<code>71H型</code> ，置换71H型中断向量,调用DOS系统25H号子程序把用户中断的服务程序入口地址写入4×71H～4×71H＋3单元。</p></li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="用户中断请求的途径"></a>用户中断请求的途径<a class="hash-link" href="#用户中断请求的途径" title="Direct link to heading">#</a></h4><p><img alt="image-20200429183132607" src="/assets/images/image-20200429183132607-bbf6120c26b02e5a5af25e052c2a1567.png"></p><ul><li><p>用户中断请求从ISA总线B4端子(IRQ9)引入，经过主8259，从8259二级中断管理，最后由主8259向CPU提中断。</p></li><li><p>只有从8259IMR1置0，主8259IMR2置0，其中断请求方能送到CPU。 （日时钟中断和键盘中断是开放的）</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly assembly"><pre tabindex="0" class="prism-code language-assembly codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">;实现用户中断必须对主、从8259应用编程,保证中断申请由8259中断控制器提向CPU</span></span><span class="token-line" style="color:#393A34"><span class="token plain">IN        AL,   0A1H</span></span><span class="token-line" style="color:#393A34"><span class="token plain">AND       AL,   11111101B</span></span><span class="token-line" style="color:#393A34"><span class="token plain">OUT       0A1H, AL      ; 从8259</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">IN        AL,   21H</span></span><span class="token-line" style="color:#393A34"><span class="token plain">AND       AL,   11111011B</span></span><span class="token-line" style="color:#393A34"><span class="token plain">OUT       21H,  AL        ;开放主8259中断</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="footnotes"><hr><ol><li id="fn-aeoi">在第2个INTA#结束时，由8259A使ISR~i自动复位；⭐因不保留当前正在服务的中断的状态，故AEOI不能用于中断嵌套方式<a href="#fnref-aeoi" class="footnote-backref">↩</a></li><li id="fn-seoi">由CPU发出一条SEOI命令，该EOI命令中指出了所要复位的ISR的位号。⭐用于特殊屏蔽方式<a href="#fnref-seoi" class="footnote-backref">↩</a></li><li id="fn-nseoi">由CPU发出正常EOI命令没,该EOI命令使ISR~i=1的位中优先级最高的那一位复位。⭐用于普通全嵌套方式<a href="#fnref-nseoi" class="footnote-backref">↩</a></li></ol></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/dosasm/dosasm/edit/docusaurus/docs/notes-njupt/08_中断系统.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/notes-njupt/输入输出系统"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 7 输入/输出系统</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/notes-njupt/串口通信"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">9 串口通信 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#81中断的基本概念" class="table-of-contents__link">8.1中断的基本概念</a><ul><li><a href="#中断概念的引入及描述" class="table-of-contents__link">中断概念的引入及描述</a></li><li><a href="#中断源及中断分类" class="table-of-contents__link">中断源及中断分类</a></li><li><a href="#中断类型码" class="table-of-contents__link">中断类型码</a></li></ul></li><li><a href="#82多级中断管理" class="table-of-contents__link">8.2多级中断管理</a><ul><li><a href="#1中断优先与中断分级" class="table-of-contents__link">1.中断优先与中断分级</a></li><li><a href="#2禁止中断与中断屏蔽" class="table-of-contents__link">2.禁止中断与中断屏蔽</a></li><li><a href="#3中断嵌套" class="table-of-contents__link">3.中断嵌套</a></li><li><a href="#4中断系统应具备的基本功能" class="table-of-contents__link">4.中断系统应具备的基本功能</a></li></ul></li><li><a href="#83-80x86的中断指令" class="table-of-contents__link">8.3 80x86的中断指令</a><ul><li><a href="#int-n指令的执行过程" class="table-of-contents__link">INT n指令的执行过程</a></li></ul></li><li><a href="#84-中断控制器8259a" class="table-of-contents__link">8.4 中断控制器8259A</a><ul><li><a href="#841-8259a功能" class="table-of-contents__link">8.4.1 8259A功能</a></li><li><a href="#842-8259a结构" class="table-of-contents__link">8.4.2 8259A结构</a></li><li><a href="#843-8259a的中断管理方式" class="table-of-contents__link">8.4.3 8259A的中断管理方式</a></li><li><a href="#852-非屏蔽中断" class="table-of-contents__link">8.5.2 非屏蔽中断</a></li><li><a href="#853-可屏蔽中断" class="table-of-contents__link">8.5.3 可屏蔽中断</a></li></ul></li><li><a href="#86-微型计算机系统中用到的中断及应用举例" class="table-of-contents__link">8.6 微型计算机系统中用到的中断及应用举例</a><ul><li><a href="#861-日时钟中断" class="table-of-contents__link">8.6.1 日时钟中断</a></li><li><a href="#862-键盘中断" class="table-of-contents__link">8.6.2 键盘中断</a></li><li><a href="#863-实时中断" class="table-of-contents__link">8.6.3 实时中断</a></li><li><a href="#864-用户中断" class="table-of-contents__link">8.6.4 用户中断</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference">References</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dosasm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitee.com/dosasm/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://js-dos.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Js-Dos<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 DosAsm Project. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5f318c0f.js"></script>
<script src="/assets/js/main.76761419.js"></script>
</body>
</html>